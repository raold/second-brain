<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Brain - Comprehensive Development Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .dashboard-container {
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
        }
        
        .dashboard-header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .dashboard-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .dashboard-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-left: 10px;
            color: #2c3e50;
        }
        
        .section-header .icon {
            font-size: 1.8rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid #4facfe;
            transition: all 0.2s ease;
        }
        
        .metric-card:hover {
            background: #e9ecef;
            transform: scale(1.02);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 5px;
            display: block;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .metric-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .metric-change.positive {
            color: #28a745;
        }
        
        .metric-change.negative {
            color: #dc3545;
        }
        
        .status-indicators {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 2px solid transparent;
        }
        
        .status-indicator.healthy {
            border-color: #28a745;
            color: #28a745;
        }
        
        .status-indicator.warning {
            border-color: #ffc107;
            color: #ffc107;
        }
        
        .status-indicator.error {
            border-color: #dc3545;
            color: #dc3545;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-dot.healthy {
            background: #28a745;
        }
        
        .status-dot.warning {
            background: #ffc107;
        }
        
        .status-dot.error {
            background: #dc3545;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .chart-container canvas {
            max-height: 300px !important;
        }
        
        .activity-tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 4px;
        }
        
        .activity-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .activity-tab.active {
            background: #4facfe;
            color: white;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.3);
        }
        
        .activity-tab:hover {
            background: #e9ecef;
        }
        
        .activity-tab.active:hover {
            background: #3a8fe6;
        }
        
        .timeline-container {
            position: relative;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .timeline-item {
            display: flex;
            margin-bottom: 20px;
            position: relative;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: 19px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background: #e9ecef;
        }
        
        .timeline-item:last-child:before {
            display: none;
        }
        
        .timeline-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4facfe;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }
        
        .timeline-content {
            flex: 1;
            margin-left: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }
        
        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .timeline-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .timeline-meta {
            font-size: 0.8rem;
            color: #999;
        }
        
        .git-visualization {
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }
        
        .branch-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .branch-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s ease;
        }
        
        .branch-item:hover {
            background: #e9ecef;
        }
        
        .branch-item:last-child {
            border-bottom: none;
        }
        
        .branch-name {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .branch-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
            color: #666;
        }
        
        .current-branch {
            background: linear-gradient(90deg, rgba(79, 172, 254, 0.1) 0%, rgba(79, 172, 254, 0.05) 100%);
            border-left: 4px solid #4facfe;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #666;
        }
        
        .loading:before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: linear-gradient(90deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            margin: 10px 0;
        }
        
        .success {
            background: linear-gradient(90deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }
        
        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4facfe;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            transform: translateX(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .refresh-indicator.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>üß† Second Brain Development Dashboard</h1>
            <div class="subtitle">Comprehensive Real-time System Monitoring & Analytics</div>
        </div>
        
        <div class="refresh-indicator" id="refreshIndicator">
            üîÑ Refreshing data...
        </div>
        
        <div class="dashboard-grid">
            <!-- System Health & API Status -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="icon">üè•</span>
                    <h2>System Health & API Status</h2>
                </div>
                <div class="status-indicators" id="apiStatus">
                    <div class="loading">Loading API status...</div>
                </div>
                <div class="metrics-grid" id="healthMetrics">
                    <div class="loading">Loading health metrics...</div>
                </div>
                <div class="chart-container">
                    <canvas id="responseTimeChart"></canvas>
                </div>
            </div>
            
            <!-- Git Repository Status -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="icon">üåø</span>
                    <h2>Git Repository Status</h2>
                </div>
                <div class="metrics-grid" id="gitMetrics">
                    <div class="loading">Loading git status...</div>
                </div>
                <div class="branch-list" id="branchList">
                    <div class="loading">Loading branches...</div>
                </div>
            </div>
            
            <!-- Commit Activity Analytics -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="icon">üìà</span>
                    <h2>Commit Activity Analytics</h2>
                </div>
                <div class="activity-tabs">
                    <button class="activity-tab active" data-period="24h">24 Hours</button>
                    <button class="activity-tab" data-period="7d">7 Days</button>
                    <button class="activity-tab" data-period="30d">30 Days</button>
                </div>
                <div class="metrics-grid" id="activityMetrics">
                    <div class="loading">Loading activity data...</div>
                </div>
                <div class="branch-activity" id="branchActivity">
                    <div class="loading">Loading branch activity...</div>
                </div>
                <div class="chart-container">
                    <canvas id="commitActivityChart"></canvas>
                </div>
            </div>
            
            <!-- Memory & Processing -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="icon">üß†</span>
                    <h2>Memory & Processing</h2>
                </div>
                <div class="metrics-grid" id="processingMetrics">
                    <div class="loading">Loading processing data...</div>
                </div>
                <div class="chart-container">
                    <canvas id="processingChart"></canvas>
                </div>
            </div>
            
            <!-- Development Timeline -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="icon">üóìÔ∏è</span>
                    <h2>Development Timeline & Milestones</h2>
                </div>
                <div class="timeline-container" id="timelineContainer">
                    <div class="loading">Loading timeline...</div>
                </div>
            </div>
            
            <!-- Git Branch Visualization -->
            <div class="dashboard-section">
                <div class="section-header">
                    <span class="icon">üå≥</span>
                    <h2>Branch Visualization</h2>
                </div>
                <div class="git-visualization" id="gitVisualization">
                    <div class="loading">Loading git visualization...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentPeriod = '24h';
        let dashboardData = {
            system: null,
            git: null,
            activity: null,
            processing: null,
            timeline: null
        };
        let charts = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            setupEventListeners();
            loadAllData();
            
            // Auto-refresh every 30 seconds
            setInterval(loadAllData, 30000);
        });

        function setupEventListeners() {
            // Activity period tabs
            document.querySelectorAll('.activity-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    updateActivityDisplay();
                });
            });
        }

        function showRefreshIndicator() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        async function loadAllData() {
            showRefreshIndicator();
            
            try {
                await Promise.all([
                    loadSystemHealth(),
                    loadGitStatus(),
                    loadCommitActivity(),
                    loadProcessingData(),
                    loadTimeline(),
                    loadGitVisualization()
                ]);
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // System Health
        async function loadSystemHealth() {
            try {
                // Load mock database data
                const response = await fetch('/dashboard_data/dashboard_data.json');
                const data = await response.json();
                dashboardData.system = data;
                
                displayApiStatus(data.api_status);
                displayHealthMetrics(data);
                updateResponseTimeChart(data);
            } catch (error) {
                document.getElementById('apiStatus').innerHTML = '<div class="error">Failed to load system health</div>';
            }
        }

        function displayApiStatus(apiStatus) {
            const container = document.getElementById('apiStatus');
            if (!apiStatus) return;

            container.innerHTML = Object.entries(apiStatus).map(([endpoint, data]) => {
                const statusClass = data.status === 'active' ? 'healthy' : 'error';
                return `
                    <div class="status-indicator ${statusClass}">
                        <div class="status-dot ${statusClass}"></div>
                        ${endpoint} (${data.response_time})
                    </div>
                `;
            }).join('');
        }

        function displayHealthMetrics(data) {
            const container = document.getElementById('healthMetrics');
            const metrics = [
                { label: 'Tests Passing', value: data.quality_metrics?.tests_passing || 0, unit: '' },
                { label: 'Code Coverage', value: data.quality_metrics?.code_coverage || 0, unit: '%' },
                { label: 'Avg Response', value: data.performance_metrics?.avg_response_time || 0, unit: 'ms' },
                { label: 'Uptime', value: data.system_metrics?.uptime || 0, unit: '%' }
            ];

            container.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-value">${metric.value}${metric.unit}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        // Git Status
        async function loadGitStatus() {
            try {
                const response = await fetch('/dashboard/git/repository-status');
                const data = await response.json();
                dashboardData.git = data;
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                displayGitMetrics(data);
                displayBranchList(data);
            } catch (error) {
                document.getElementById('gitMetrics').innerHTML = '<div class="error">Failed to load git status</div>';
            }
        }

        function displayGitMetrics(data) {
            const container = document.getElementById('gitMetrics');
            const metrics = [
                { label: 'Current Branch', value: data.current_branch || 'Unknown' },
                { label: 'Total Branches', value: data.total_branches || 0 },
                { label: 'Uncommitted', value: data.has_uncommitted_changes ? 'Yes' : 'No' }
            ];

            container.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        function displayBranchList(data) {
            const container = document.getElementById('branchList');
            if (!data.branches) return;

            container.innerHTML = data.branches.slice(0, 8).map(branch => `
                <div class="branch-item ${branch === data.current_branch ? 'current-branch' : ''}" onclick="switchToBranch('${branch}')">
                    <div class="branch-name">${branch}</div>
                    <div class="branch-meta">
                        ${branch === data.current_branch ? '<span>üëë Current</span>' : '<span>üîÑ Click to view</span>'}
                    </div>
                </div>
            `).join('');
        }

        // Commit Activity
        async function loadCommitActivity() {
            try {
                const response = await fetch('/dashboard/git/commit-activity');
                const data = await response.json();
                dashboardData.activity = data;
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                updateActivityDisplay();
            } catch (error) {
                document.getElementById('activityMetrics').innerHTML = '<div class="error">Failed to load activity</div>';
            }
        }

        function updateActivityDisplay() {
            if (!dashboardData.activity?.repository_summary) return;

            const summary = dashboardData.activity.repository_summary[currentPeriod] || {};
            
            // Update activity summary
            const activitySummary = document.getElementById('activityMetrics');
            activitySummary.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${summary.commits || 0}</div>
                    <div class="metric-label">Commits</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${(summary.lines_added || 0).toLocaleString()}</div>
                    <div class="metric-label">Lines Added</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${(summary.lines_deleted || 0).toLocaleString()}</div>
                    <div class="metric-label">Lines Deleted</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${summary.authors || 0}</div>
                    <div class="metric-label">Authors</div>
                </div>
            `;

            // Update branch activity with detailed information
            displayBranchActivity();
            updateCommitActivityChart();
        }

        // Display branch activity with detailed metrics
        function displayBranchActivity() {
            const branchActivity = document.getElementById('branchActivity');
            if (!dashboardData.activity?.branch_activity) {
                branchActivity.innerHTML = '<div class="loading">No branch activity data available</div>';
                return;
            }

            const branchData = dashboardData.activity.branch_activity;
            const branches = Object.entries(branchData)
                .filter(([name, data]) => data.metrics && data.metrics[currentPeriod])
                .sort(([,a], [,b]) => (b.metrics[currentPeriod].commit_count || 0) - (a.metrics[currentPeriod].commit_count || 0))
                .slice(0, 6); // Show top 6 active branches

            if (branches.length === 0) {
                branchActivity.innerHTML = '<div class="loading">No branch activity for selected period</div>';
                return;
            }

            branchActivity.innerHTML = branches.map(([branchName, branchInfo]) => {
                const metrics = branchInfo.metrics[currentPeriod] || {};
                const commits = metrics.commit_count || 0;
                const linesAdded = metrics.lines_added || 0;
                const linesDeleted = metrics.lines_deleted || 0;
                const authors = metrics.authors || [];
                
                // Determine activity level for styling
                let activityClass = 'low-activity';
                if (commits >= 10) activityClass = 'high-activity';
                else if (commits >= 3) activityClass = 'medium-activity';

                // Extract version info from branch name
                const versionMatch = branchName.match(/v(\d+\.\d+\.\d+)/);
                const version = versionMatch ? versionMatch[1] : '';
                
                // Extract features
                const features = branchInfo.features || [];
                const featureText = features.length > 0 ? features.join(', ') : 'general';

                return `
                    <div class="branch-card ${activityClass}" onclick="switchToBranch('${branchName}')" style="cursor: pointer;">
                        <div class="branch-name">
                            ${branchName.replace('origin/', '')} 
                            ${branchInfo.is_current ? 'üëë' : ''}
                            ${version ? `<span style="color: #666; font-size: 0.8rem;">(${version})</span>` : ''}
                        </div>
                        <div class="branch-stats">
                            <div style="margin-bottom: 8px;">
                                <strong>üìà Activity:</strong> ${commits} commits
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>üìä Changes:</strong> +${linesAdded.toLocaleString()}/-${linesDeleted.toLocaleString()} lines
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>üè∑Ô∏è Features:</strong> ${featureText}
                            </div>
                            ${authors.length > 0 ? `<div><strong>üë• Authors:</strong> ${authors.slice(0, 3).join(', ')}</div>` : ''}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem; color: #666;">
                            ${branchInfo.commit_info || 'No recent commits'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Branch switching function
        async function switchToBranch(branchName) {
            try {
                const response = await fetch(`/api/branches/${encodeURIComponent(branchName)}`);
                if (!response.ok) {
                    throw new Error(`Failed to load branch: ${response.statusText}`);
                }
                
                const branchData = await response.json();
                showBranchDetails(branchData);
            } catch (error) {
                console.error('Error switching to branch:', error);
                alert(`Failed to load branch details: ${error.message}`);
            }
        }

        // Show detailed branch information in a modal or expanded view
        function showBranchDetails(branchData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            const versionMatch = branchData.id.match(/v(\d+\.\d+\.\d+)/);
            const version = versionMatch ? versionMatch[1] : 'No version';
            const features = branchData.features || [];
            const featureText = features.length > 0 ? features.join(', ') : 'general development';

            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; color: #2c3e50;">üåø ${branchData.name}</h2>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #4facfe; margin-bottom: 10px;">üìã Branch Information</h3>
                        <p><strong>Status:</strong> ${branchData.status} ${branchData.is_current ? '(Current Branch)' : ''}</p>
                        <p><strong>Version:</strong> ${version}</p>
                        <p><strong>Features:</strong> ${featureText}</p>
                        <p><strong>Latest Commit:</strong> ${branchData.commit_info || 'No commit info'}</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #4facfe; margin-bottom: 10px;">üìà Activity Metrics</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                            ${['24h', '7d', '30d'].map(period => {
                                const metrics = branchData[`metrics_${period}`] || {};
                                return `
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                                        <div style="font-weight: bold; color: #4facfe; margin-bottom: 5px;">${period.toUpperCase()}</div>
                                        <div style="font-size: 0.9rem;">
                                            <div>${metrics.commit_count || 0} commits</div>
                                            <div>+${(metrics.lines_added || 0).toLocaleString()} lines</div>
                                            <div>${(metrics.authors || []).length} authors</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    ${branchData.metrics_24h?.authors?.length > 0 ? `
                        <div>
                            <h3 style="color: #4facfe; margin-bottom: 10px;">üë• Recent Contributors</h3>
                            <p>${branchData.metrics_24h.authors.join(', ')}</p>
                        </div>
                    ` : ''}
                </div>
            `;

            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Processing Data
        async function loadProcessingData() {
            try {
                const response = await fetch('/dashboard_data/dashboard_data.json');
                const data = await response.json();
                
                displayProcessingMetrics(data);
                updateProcessingChart(data);
            } catch (error) {
                document.getElementById('processingMetrics').innerHTML = '<div class="error">Failed to load processing data</div>';
            }
        }

        function displayProcessingMetrics(data) {
            const container = document.getElementById('processingMetrics');
            const metrics = [
                { label: 'Memories Today', value: data.woodchipper_processing?.memories_processed_today || 0 },
                { label: 'Items/Minute', value: data.woodchipper_processing?.items_per_minute || 0 },
                { label: 'CPU Usage', value: data.woodchipper_processing?.cpu_utilization || 0, unit: '%' },
                { label: 'Avg Time', value: data.woodchipper_processing?.avg_processing_time || 0, unit: 'ms' }
            ];

            container.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-value">${metric.value}${metric.unit || ''}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        // Timeline
        async function loadTimeline() {
            try {
                const response = await fetch('/dashboard_data/dashboard_data.json');
                const data = await response.json();
                
                displayTimeline(data);
            } catch (error) {
                document.getElementById('timelineContainer').innerHTML = '<div class="error">Failed to load timeline</div>';
            }
        }

        function displayTimeline(data) {
            const container = document.getElementById('timelineContainer');
            const timeline = data.timeline_milestones?.milestones || [];
            
            if (timeline.length === 0) {
                container.innerHTML = '<div class="loading">No timeline data available</div>';
                return;
            }

            container.innerHTML = timeline.map((item, index) => `
                <div class="timeline-item">
                    <div class="timeline-marker">v${item.version}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">${item.title}</div>
                        <div class="timeline-description">${item.description}</div>
                        <div class="timeline-meta">${item.completion} complete ‚Ä¢ ${item.days_remaining} days remaining</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${item.completion}"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Git Visualization
        async function loadGitVisualization() {
            try {
                const response = await fetch('/dashboard/git/visualization');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                createGitVisualization(data);
            } catch (error) {
                document.getElementById('gitVisualization').innerHTML = '<div class="error">Failed to load git visualization</div>';
            }
        }

        function createGitVisualization(data) {
            const container = document.getElementById('gitVisualization');
            container.innerHTML = '';

            if (!data.nodes || data.nodes.length === 0) {
                container.innerHTML = '<div class="loading">No visualization data available</div>';
                return;
            }

            const width = container.clientWidth;
            const height = 400;

            const svg = d3.select('#gitVisualization')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Create simulation
            const simulation = d3.forceSimulation(data.nodes)
                .force('link', d3.forceLink(data.links).id(d => d.id).distance(80))
                .force('charge', d3.forceManyBody().strength(-200))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(15));

            // Add links
            const link = svg.append('g')
                .selectAll('line')
                .data(data.links)
                .join('line')
                .attr('stroke', '#999')
                .attr('stroke-opacity', 0.4)
                .attr('stroke-width', 2);

            // Add nodes
            const node = svg.append('g')
                .selectAll('circle')
                .data(data.nodes)
                .join('circle')
                .attr('r', d => d.is_current ? 10 : 6)
                .attr('fill', d => {
                    if (d.group === 'main') return '#4facfe';
                    if (d.group === 'feature') return '#52c41a';
                    if (d.group === 'testing') return '#13c2c2';
                    if (d.group === 'development') return '#722ed1';
                    return '#8c8c8c';
                })
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            // Add labels
            const labels = svg.append('g')
                .selectAll('text')
                .data(data.nodes)
                .join('text')
                .text(d => d.id.replace('origin/', '').substring(0, 12))
                .attr('font-size', '10px')
                .attr('dx', 12)
                .attr('dy', 3)
                .attr('fill', '#333');

            // Add tooltips
            node.append('title')
                .text(d => `${d.id}${d.is_current ? ' (current)' : ''}\nStatus: ${d.status || 'unknown'}`);

            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);

                labels
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        // Chart initialization and updates
        function initializeCharts() {
            // Response Time Chart
            const responseTimeCtx = document.getElementById('responseTimeChart').getContext('2d');
            charts.responseTime = new Chart(responseTimeCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: [],
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Commit Activity Chart
            const commitActivityCtx = document.getElementById('commitActivityChart').getContext('2d');
            charts.commitActivity = new Chart(commitActivityCtx, {
                type: 'bar',
                data: {
                    labels: ['24h', '7d', '30d'],
                    datasets: [{
                        label: 'Commits',
                        data: [0, 0, 0],
                        backgroundColor: 'rgba(79, 172, 254, 0.8)',
                        borderColor: '#4facfe',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Processing Chart
            const processingCtx = document.getElementById('processingChart').getContext('2d');
            charts.processing = new Chart(processingCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Processed', 'Remaining'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#4facfe', '#e9ecef'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%'
                }
            });
        }

        function updateResponseTimeChart(data) {
            if (!data.api_status || !charts.responseTime) return;

            const labels = Object.keys(data.api_status);
            const values = Object.values(data.api_status).map(api => 
                parseInt(api.response_time.replace('ms', '')) || 0
            );

            charts.responseTime.data.labels = labels;
            charts.responseTime.data.datasets[0].data = values;
            charts.responseTime.update();
        }

        function updateCommitActivityChart() {
            if (!dashboardData.activity?.repository_summary || !charts.commitActivity) return;

            const data = dashboardData.activity.repository_summary;
            const values = ['24h', '7d', '30d'].map(period => data[period]?.commits || 0);

            charts.commitActivity.data.datasets[0].data = values;
            charts.commitActivity.update();
        }

        function updateProcessingChart(data) {
            if (!data.woodchipper_processing || !charts.processing) return;

            const processed = data.woodchipper_processing.memories_processed_today || 0;
            const total = 100; // Assume daily target
            const remaining = Math.max(0, total - processed);

            charts.processing.data.datasets[0].data = [processed, remaining];
            charts.processing.update();
        }
    </script>
</body>
</html>
