<!DOCTYPE html>
<html lang="en" data-theme="gruvbox-dark" data-density="comfortable">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Second Brain v3</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/css/main.css">
    
    <!-- Settings Management -->
    <script src="/static/js/settings.js"></script>
    
    <style>
        /* Page-specific styles */

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--gruvbox-bg0);
            color: var(--gruvbox-fg1);
            margin: 0;
            padding: 0;
        }

        /* Navigation styles in separate CSS file */

        /* Dashboard Layout */
        .dashboard {
            padding: var(--space-4) 0;
        }

        /* Status Bar */
        .status-bar {
            background: var(--gruvbox-bg0-soft);
            border: 1px solid var(--gruvbox-bg2);
            border-radius: var(--radius-md);
            padding: var(--space-3) var(--space-4);
            margin-bottom: var(--space-4);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-indicator.online {
            background: var(--gruvbox-green);
            box-shadow: 0 0 8px rgba(184, 187, 38, 0.5);
        }

        .status-indicator.warning {
            background: var(--gruvbox-yellow);
            box-shadow: 0 0 8px rgba(250, 189, 47, 0.5);
        }

        .status-indicator.error {
            background: var(--gruvbox-red);
            box-shadow: 0 0 8px rgba(251, 73, 52, 0.5);
        }

        .status-text {
            font-size: var(--text-sm);
            color: var(--gruvbox-fg2);
        }

        .status-value {
            font-weight: 600;
            color: var(--gruvbox-fg0);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-auto-rows: minmax(120px, auto);
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        /* Metric Cards */
        .metric-card {
            background: var(--gruvbox-bg0-soft);
            border: 1px solid var(--gruvbox-bg2);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all var(--duration-fast);
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            border-color: var(--gruvbox-aqua-dim);
            box-shadow: var(--shadow-md);
        }

        .metric-card.span-2 { grid-column: span 2; }
        .metric-card.span-3 { grid-column: span 3; }
        .metric-card.span-4 { grid-column: span 4; }
        .metric-card.span-6 { grid-column: span 6; }
        .metric-card.row-2 { grid-row: span 2; }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-2);
        }

        .metric-title {
            font-size: var(--text-sm);
            color: var(--gruvbox-fg3);
            font-weight: 500;
        }

        .metric-badge {
            font-size: var(--text-xs);
            padding: 2px 6px;
            background: var(--gruvbox-bg1);
            border-radius: var(--radius-sm);
            color: var(--gruvbox-fg4);
        }

        .metric-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--gruvbox-fg0);
            line-height: 1;
            margin-bottom: var(--space-1);
        }

        .metric-change {
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .metric-change.positive {
            color: var(--gruvbox-green);
        }

        .metric-change.negative {
            color: var(--gruvbox-red);
        }

        /* Sparkline Charts */
        .sparkline {
            height: 40px;
            margin-top: var(--space-2);
        }

        .sparkline svg {
            width: 100%;
            height: 100%;
        }

        .sparkline path {
            fill: none;
            stroke: var(--gruvbox-aqua);
            stroke-width: 2;
        }

        .sparkline-area {
            fill: var(--gruvbox-aqua);
            opacity: 0.1;
        }

        /* Activity Heatmap */
        .heatmap {
            display: grid;
            grid-template-columns: repeat(52, 1fr);
            gap: 2px;
            margin-top: var(--space-3);
        }

        .heatmap-cell {
            aspect-ratio: 1;
            background: var(--gruvbox-bg1);
            border-radius: 2px;
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .heatmap-cell:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-sm);
        }

        .heatmap-cell.level-0 { background: var(--gruvbox-bg1); }
        .heatmap-cell.level-1 { background: var(--gruvbox-aqua-dim); opacity: 0.3; }
        .heatmap-cell.level-2 { background: var(--gruvbox-aqua-dim); opacity: 0.6; }
        .heatmap-cell.level-3 { background: var(--gruvbox-aqua); opacity: 0.8; }
        .heatmap-cell.level-4 { background: var(--gruvbox-aqua); }

        /* Data Tables */
        .data-section {
            background: var(--gruvbox-bg0-soft);
            border: 1px solid var(--gruvbox-bg2);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-4);
            overflow: hidden;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--gruvbox-bg2);
        }

        .data-title {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--gruvbox-fg0);
        }

        .data-actions {
            display: flex;
            gap: var(--space-2);
        }

        .filter-chips {
            display: flex;
            gap: var(--space-2);
        }

        .chip {
            padding: var(--space-1) var(--space-3);
            background: var(--gruvbox-bg1);
            border: 1px solid var(--gruvbox-bg3);
            border-radius: var(--radius-base);
            font-size: var(--text-sm);
            color: var(--gruvbox-fg2);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .chip:hover {
            background: var(--gruvbox-bg2);
            border-color: var(--gruvbox-bg4);
        }

        .chip.active {
            background: var(--gruvbox-aqua-dim);
            color: var(--gruvbox-fg0);
            border-color: var(--gruvbox-aqua);
        }

        /* Compact Data Table */
        .data-table-compact {
            width: 100%;
            font-size: var(--text-sm);
        }

        .data-table-compact th {
            text-align: left;
            padding: var(--space-2) var(--space-4);
            background: var(--gruvbox-bg1);
            color: var(--gruvbox-fg0);
            font-weight: 600;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table-compact td {
            padding: var(--space-2) var(--space-4);
            border-top: 1px solid var(--gruvbox-bg2);
        }

        .data-table-compact tbody tr {
            transition: background var(--duration-fast);
        }

        .data-table-compact tbody tr:hover {
            background: var(--gruvbox-bg1);
        }

        /* Quick Actions Toolbar */
        .toolbar {
            position: fixed;
            bottom: var(--space-4);
            left: 50%;
            transform: translateX(-50%);
            background: var(--gruvbox-bg0);
            border: 1px solid var(--gruvbox-bg3);
            border-radius: var(--radius-lg);
            padding: var(--space-2);
            display: flex;
            gap: var(--space-2);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-fixed);
        }

        .toolbar-btn {
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: none;
            color: var(--gruvbox-fg2);
            cursor: pointer;
            border-radius: var(--radius-base);
            transition: all var(--duration-fast);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
        }

        .toolbar-btn:hover {
            background: var(--gruvbox-bg1);
            color: var(--gruvbox-fg0);
        }

        /* Performance Metrics */
        .perf-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .perf-item {
            text-align: center;
        }

        .perf-label {
            font-size: var(--text-xs);
            color: var(--gruvbox-fg4);
            margin-bottom: var(--space-1);
        }

        .perf-bar {
            height: 4px;
            background: var(--gruvbox-bg2);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: var(--space-1);
        }

        .perf-fill {
            height: 100%;
            background: var(--gruvbox-aqua);
            transition: width var(--duration-slow);
        }

        .perf-value {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--gruvbox-fg0);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            .metric-card.span-6 { grid-column: span 4; }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .metric-card.span-2,
            .metric-card.span-3,
            .metric-card.span-4,
            .metric-card.span-6 { 
                grid-column: span 2; 
            }
            .status-bar {
                grid-template-columns: 1fr;
            }
            .toolbar {
                width: calc(100% - var(--space-8));
                left: var(--space-4);
                transform: none;
            }
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: var(--gruvbox-bg0);
            border: 1px solid var(--gruvbox-bg3);
            border-radius: var(--radius-base);
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-sm);
            color: var(--gruvbox-fg1);
            box-shadow: var(--shadow-md);
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--duration-fast);
            z-index: var(--z-tooltip);
        }

        .tooltip.show {
            opacity: 1;
        }

        /* Loading skeleton */
        .skeleton-loader {
            animation: skeleton-loading 1.5s infinite ease-in-out;
            background: linear-gradient(
                90deg,
                var(--gruvbox-bg2) 25%,
                var(--gruvbox-bg3) 50%,
                var(--gruvbox-bg2) 75%
            );
            background-size: 200% 100%;
            border-radius: var(--radius-base);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="/" class="logo">
                üß† <span>Second Brain</span> v3
            </a>
            <ul class="nav-links">
                <li><a href="/insights">Insights</a></li>
                <li><a href="/api">API</a></li>
                <li><a href="/documentation">Docs</a></li>
                <li><a href="#" onclick="showSettings()">‚öôÔ∏è</a></li>
            </ul>
        </div>
    </nav>

    <!-- Dashboard -->
    <div class="dashboard">
        <div class="container container-wide">
            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-indicator online"></span>
                    <span class="status-text">System: <span class="status-value">Operational</span></span>
                </div>
                <div class="status-item">
                    <span class="status-text">Uptime: <span class="status-value">99.9%</span></span>
                </div>
                <div class="status-item">
                    <span class="status-text">Response: <span class="status-value">42ms</span></span>
                </div>
                <div class="status-item">
                    <span class="status-text">Version: <span class="status-value">v3.0.0</span></span>
                </div>
                <div class="status-item">
                    <span class="status-text">Build: <span class="status-value">#fb96813</span></span>
                </div>
                <div class="status-item">
                    <span class="status-text">Tests: <span class="status-value">430 ‚úì</span></span>
                </div>
            </div>

            <!-- Metrics Grid -->
            <div class="dashboard-grid">
                <!-- Memory Metrics -->
                <div class="metric-card">
                    <div class="metric-header">
                        <h3 class="metric-title">Memories</h3>
                    </div>
                    <div class="metric-value">1,234</div>
                    <div class="metric-change positive">
                        <span>‚Üë 12%</span>
                    </div>
                    <div class="sparkline" id="memories-spark"></div>
                </div>

                <!-- Search Metrics -->
                <div class="metric-card">
                    <div class="metric-header">
                        <h3 class="metric-title">Searches</h3>
                    </div>
                    <div class="metric-value">89</div>
                    <div class="metric-change positive">
                        <span>‚Üë 5%</span>
                    </div>
                    <div class="sparkline" id="searches-spark"></div>
                </div>

                <!-- Insights -->
                <div class="metric-card">
                    <div class="metric-header">
                        <h3 class="metric-title">Insights</h3>
                    </div>
                    <div class="metric-value">23</div>
                    <div class="metric-change negative">
                        <span>‚Üì 3%</span>
                    </div>
                    <div class="sparkline" id="insights-spark"></div>
                </div>

                <!-- Performance -->
                <div class="metric-card">
                    <div class="metric-header">
                        <h3 class="metric-title">Avg Response</h3>
                    </div>
                    <div class="metric-value">42ms</div>
                    <div class="metric-change positive">
                        <span>‚Üì 8ms</span>
                    </div>
                    <div class="sparkline" id="response-spark"></div>
                </div>

                <!-- Coverage -->
                <div class="metric-card">
                    <div class="metric-header">
                        <h3 class="metric-title">Coverage</h3>
                    </div>
                    <div class="metric-value">92%</div>
                    <div class="metric-change positive">
                        <span>‚Üë 2%</span>
                    </div>
                    <div class="sparkline" id="coverage-spark"></div>
                </div>

                <!-- Error Rate -->
                <div class="metric-card">
                    <div class="metric-header">
                        <h3 class="metric-title">Error Rate</h3>
                    </div>
                    <div class="metric-value">0.1%</div>
                    <div class="metric-change positive">
                        <span>‚Üì 0.2%</span>
                    </div>
                    <div class="sparkline" id="errors-spark"></div>
                </div>

                <!-- Activity Heatmap -->
                <div class="metric-card span-4 row-2">
                    <div class="metric-header">
                        <h3 class="metric-title">Git Activity</h3>
                        <span class="metric-badge">Last 52 weeks</span>
                    </div>
                    <div class="heatmap" id="activity-heatmap">
                        <!-- Generated dynamically -->
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: var(--space-2);">
                        <span class="text-xs" style="color: var(--gruvbox-fg4);">Less</span>
                        <div style="display: flex; gap: 2px;">
                            <div class="heatmap-cell level-0" style="width: 10px; height: 10px;"></div>
                            <div class="heatmap-cell level-1" style="width: 10px; height: 10px;"></div>
                            <div class="heatmap-cell level-2" style="width: 10px; height: 10px;"></div>
                            <div class="heatmap-cell level-3" style="width: 10px; height: 10px;"></div>
                            <div class="heatmap-cell level-4" style="width: 10px; height: 10px;"></div>
                        </div>
                        <span class="text-xs" style="color: var(--gruvbox-fg4);">More</span>
                    </div>
                </div>

                <!-- Performance Breakdown -->
                <div class="metric-card span-2 row-2">
                    <div class="metric-header">
                        <h3 class="metric-title">Performance Breakdown</h3>
                    </div>
                    <div class="perf-grid">
                        <div class="perf-item">
                            <div class="perf-label">CPU</div>
                            <div class="perf-bar">
                                <div class="perf-fill" style="width: 35%;"></div>
                            </div>
                            <div class="perf-value">35%</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">Memory</div>
                            <div class="perf-bar">
                                <div class="perf-fill" style="width: 62%;"></div>
                            </div>
                            <div class="perf-value">62%</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">Disk</div>
                            <div class="perf-bar">
                                <div class="perf-fill" style="width: 28%;"></div>
                            </div>
                            <div class="perf-value">28%</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">Network</div>
                            <div class="perf-bar">
                                <div class="perf-fill" style="width: 15%;"></div>
                            </div>
                            <div class="perf-value">15%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Commits -->
            <div class="data-section">
                <div class="data-header">
                    <h2 class="data-title">Recent Commits</h2>
                    <div class="data-actions">
                        <button class="btn btn-ghost btn-sm">
                            View All
                        </button>
                    </div>
                </div>
                <table class="data-table-compact">
                    <thead>
                        <tr>
                            <th>Commit</th>
                            <th>Message</th>
                            <th>Author</th>
                            <th>Stats</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="commits-table">
                        <tr>
                            <td><code style="font-size: var(--text-xs);">fb96813</code></td>
                            <td>feat: Add comprehensive UI with dashboard</td>
                            <td>Claude</td>
                            <td><span style="color: var(--gruvbox-green);">+7362</span> <span style="color: var(--gruvbox-red);">-53</span></td>
                            <td>2 hours ago</td>
                        </tr>
                        <tr>
                            <td><code style="font-size: var(--text-xs);">ba58763</code></td>
                            <td>fix: Add better diagnostics to CD pipeline</td>
                            <td>raold</td>
                            <td><span style="color: var(--gruvbox-green);">+45</span> <span style="color: var(--gruvbox-red);">-12</span></td>
                            <td>5 hours ago</td>
                        </tr>
                        <tr>
                            <td><code style="font-size: var(--text-xs);">08aadc5</code></td>
                            <td>fix: CD pipeline port conflicts</td>
                            <td>raold</td>
                            <td><span style="color: var(--gruvbox-green);">+28</span> <span style="color: var(--gruvbox-red);">-15</span></td>
                            <td>8 hours ago</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- TODO Tracker -->
            <div class="data-section">
                <div class="data-header">
                    <h2 class="data-title">Development Tasks</h2>
                    <div class="filter-chips">
                        <button class="chip active" data-filter="all">All (25)</button>
                        <button class="chip" data-filter="pending">Pending (10)</button>
                        <button class="chip" data-filter="in-progress">In Progress (3)</button>
                        <button class="chip" data-filter="completed">Completed (12)</button>
                    </div>
                </div>
                <table class="data-table-compact">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Task</th>
                            <th>Priority</th>
                            <th>Updated</th>
                        </tr>
                    </thead>
                    <tbody id="todos-table">
                        <tr>
                            <td><span class="status-indicator warning" style="display: inline-block;"></span></td>
                            <td>Add comprehensive load testing suite</td>
                            <td><span class="chip" style="background: var(--gruvbox-orange-dim); color: var(--gruvbox-fg0);">High</span></td>
                            <td>Today</td>
                        </tr>
                        <tr>
                            <td><span class="status-indicator warning" style="display: inline-block;"></span></td>
                            <td>Implement rate limiting on all API endpoints</td>
                            <td><span class="chip" style="background: var(--gruvbox-orange-dim); color: var(--gruvbox-fg0);">High</span></td>
                            <td>Today</td>
                        </tr>
                        <tr>
                            <td><span class="status-indicator online" style="display: inline-block;"></span></td>
                            <td>Create development dashboard</td>
                            <td><span class="chip" style="background: var(--gruvbox-yellow-dim); color: var(--gruvbox-fg0);">Medium</span></td>
                            <td>2h ago</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Quick Actions Toolbar -->
    <div class="toolbar">
        <button class="toolbar-btn" onclick="refreshData()">
            <span>‚Üª</span>
            <span>Refresh</span>
        </button>
        <button class="toolbar-btn" onclick="runTests()">
            <span>‚ñ∂</span>
            <span>Run Tests</span>
        </button>
        <button class="toolbar-btn" onclick="viewLogs()">
            <span>üìã</span>
            <span>Logs</span>
        </button>
        <button class="toolbar-btn" onclick="openTerminal()">
            <span>‚å®</span>
            <span>Terminal</span>
        </button>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Generate sparklines
        function generateSparkline(elementId, data) {
            const element = document.getElementById(elementId);
            const width = element.clientWidth;
            const height = 40;
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min;
            
            const points = data.map((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - ((value - min) / range) * height;
                return `${x},${y}`;
            }).join(' ');
            
            const areaPoints = `0,${height} ${points} ${width},${height}`;
            
            element.innerHTML = `
                <svg width="${width}" height="${height}">
                    <polygon points="${areaPoints}" class="sparkline-area"/>
                    <polyline points="${points}"/>
                </svg>
            `;
        }

        // Generate activity heatmap
        function generateHeatmap() {
            const heatmap = document.getElementById('activity-heatmap');
            const weeks = 52;
            const days = 7;
            
            for (let week = 0; week < weeks; week++) {
                for (let day = 0; day < days; day++) {
                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    
                    // Random activity level
                    const level = Math.random() > 0.7 ? Math.floor(Math.random() * 5) : 0;
                    cell.classList.add(`level-${level}`);
                    
                    // Add tooltip
                    cell.addEventListener('mouseenter', (e) => {
                        showTooltip(e, `${Math.floor(Math.random() * 10)} commits`);
                    });
                    cell.addEventListener('mouseleave', hideTooltip);
                    
                    heatmap.appendChild(cell);
                }
            }
        }

        // Tooltip functions
        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.style.left = event.pageX + 'px';
            tooltip.style.top = (event.pageY - 30) + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        // Filter chips
        document.querySelectorAll('.chip[data-filter]').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.chip[data-filter]').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                // Filter logic here
            });
        });

        // Density toggle
        function toggleDensity() {
            const current = document.documentElement.getAttribute('data-density') || 'comfortable';
            const densities = ['compact', 'comfortable', 'spacious'];
            const currentIndex = densities.indexOf(current);
            const nextIndex = (currentIndex + 1) % densities.length;
            document.documentElement.setAttribute('data-density', densities[nextIndex]);
            localStorage.setItem('secondBrainDensity', densities[nextIndex]);
        }

        // Toolbar actions
        function refreshData() {
            location.reload();
        }

        function runTests() {
            console.log('Running tests...');
        }

        function viewLogs() {
            console.log('Opening logs...');
        }

        function openTerminal() {
            console.log('Opening terminal...');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Generate sample data for sparklines
            const sampleData = () => Array.from({length: 20}, () => Math.random() * 100);
            
            generateSparkline('memories-spark', sampleData());
            generateSparkline('searches-spark', sampleData());
            generateSparkline('insights-spark', sampleData());
            generateSparkline('response-spark', sampleData());
            generateSparkline('coverage-spark', sampleData());
            generateSparkline('errors-spark', sampleData());
            
            generateHeatmap();
            
            // Load saved density
            const savedDensity = localStorage.getItem('secondBrainDensity');
            if (savedDensity) {
                document.documentElement.setAttribute('data-density', savedDensity);
            }
        });

        // Auto-refresh every 30 seconds
        setInterval(() => {
            // Update data here
            console.log('Refreshing dashboard data...');
        }, 30000);
    </script>
</body>
</html>