<!DOCTYPE html>
<html lang="en" data-theme="gruvbox-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docs - Second Brain v3</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/css/main.css">
    
    <!-- Settings Management -->
    <script src="/static/js/settings.js"></script>
    
    <style>
        /* Page-specific styles */

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--gruvbox-bg0);
            color: var(--gruvbox-fg1);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        /* Navigation styles in separate CSS file */

        /* Layout Grid */
        .docs-layout {
            display: grid;
            grid-template-columns: 240px 1fr 200px;
            height: calc(100vh - 68px);
            overflow: hidden;
        }

        /* Sidebar - High Density */
        .sidebar {
            background: var(--gruvbox-bg0-soft);
            border-right: 1px solid var(--gruvbox-bg2);
            overflow-y: auto;
            padding: var(--space-3);
        }

        .sidebar-section {
            margin-bottom: var(--space-4);
        }

        .sidebar-title {
            font-size: var(--text-xs);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gruvbox-fg3);
            margin-bottom: var(--space-2);
            font-weight: 600;
        }

        .doc-tree {
            list-style: none;
        }

        .doc-item {
            margin-bottom: 2px;
        }

        .doc-link {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            color: var(--gruvbox-fg2);
            text-decoration: none;
            font-size: var(--text-sm);
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast);
            cursor: pointer;
        }

        .doc-link:hover {
            background: var(--gruvbox-bg1);
            color: var(--gruvbox-aqua);
        }

        .doc-link.active {
            background: var(--gruvbox-bg1);
            color: var(--gruvbox-aqua);
            font-weight: 500;
        }

        .doc-icon {
            font-size: var(--text-sm);
            opacity: 0.8;
        }

        /* Main Content Area */
        .content-area {
            overflow-y: auto;
            background: var(--gruvbox-bg0);
            padding: var(--space-6) var(--space-8);
        }

        .content-wrapper {
            max-width: 45rem;
            margin: 0 auto;
        }

        /* Document Grid for Home */
        .doc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .doc-card {
            background: var(--gruvbox-bg0-soft);
            border: 1px solid var(--gruvbox-bg2);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .doc-card:hover {
            transform: translateY(-2px);
            border-color: var(--gruvbox-aqua-dim);
            box-shadow: var(--shadow-md);
        }

        .doc-card h3 {
            font-size: var(--text-base);
            color: var(--gruvbox-fg0);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .doc-card p {
            font-size: var(--text-sm);
            color: var(--gruvbox-fg3);
            line-height: var(--line-height-base);
        }

        /* Document Viewer - Optimized Typography */
        .doc-header {
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--gruvbox-bg2);
        }

        .doc-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: var(--gruvbox-fg0);
            line-height: var(--line-height-tight);
            margin-bottom: var(--space-3);
        }

        .doc-meta {
            display: flex;
            gap: var(--space-4);
            font-size: var(--text-sm);
            color: var(--gruvbox-fg3);
        }

        .doc-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        /* Document Content - Enhanced Typography */
        .doc-content {
            font-size: var(--text-base);
            line-height: var(--line-height-relaxed);
            color: var(--gruvbox-fg1);
        }

        .doc-content h1 {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--gruvbox-aqua);
            margin-top: var(--space-8);
            margin-bottom: var(--space-4);
            line-height: var(--line-height-tight);
        }

        .doc-content h2 {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--gruvbox-green);
            margin-top: var(--space-6);
            margin-bottom: var(--space-3);
            line-height: var(--line-height-tight);
        }

        .doc-content h3 {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--gruvbox-yellow);
            margin-top: var(--space-5);
            margin-bottom: var(--space-2);
            line-height: var(--line-height-base);
        }

        .doc-content p {
            margin-bottom: var(--space-4);
        }

        .doc-content code {
            background: var(--gruvbox-bg1);
            color: var(--gruvbox-orange);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.875em;
        }

        .doc-content pre {
            background: var(--gruvbox-bg0-hard);
            border: 1px solid var(--gruvbox-bg2);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            overflow-x: auto;
            margin: var(--space-4) 0;
        }

        .doc-content pre code {
            background: none;
            color: var(--gruvbox-fg1);
            padding: 0;
        }

        .doc-content blockquote {
            border-left: 3px solid var(--gruvbox-aqua);
            margin: var(--space-4) 0;
            padding-left: var(--space-4);
            color: var(--gruvbox-fg2);
            font-style: italic;
        }

        .doc-content ul,
        .doc-content ol {
            margin-bottom: var(--space-4);
            padding-left: var(--space-6);
        }

        .doc-content li {
            margin-bottom: var(--space-2);
        }

        .doc-content a {
            color: var(--gruvbox-blue);
            text-decoration: none;
            border-bottom: 1px dotted var(--gruvbox-blue);
            transition: all var(--duration-fast);
        }

        .doc-content a:hover {
            color: var(--gruvbox-aqua);
            border-bottom-color: var(--gruvbox-aqua);
        }

        /* Outline Panel */
        .outline-panel {
            background: var(--gruvbox-bg0-soft);
            border-left: 1px solid var(--gruvbox-bg2);
            overflow-y: auto;
            padding: var(--space-3);
            font-size: var(--text-sm);
        }

        .outline-title {
            font-size: var(--text-xs);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gruvbox-fg3);
            margin-bottom: var(--space-3);
            font-weight: 600;
        }

        .outline-list {
            list-style: none;
        }

        .outline-item {
            margin-bottom: var(--space-1);
        }

        .outline-link {
            display: block;
            color: var(--gruvbox-fg3);
            text-decoration: none;
            padding: var(--space-1) 0;
            font-size: var(--text-xs);
            transition: color var(--duration-fast);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .outline-link:hover {
            color: var(--gruvbox-aqua);
        }

        .outline-link.h2 {
            padding-left: var(--space-3);
        }

        .outline-link.h3 {
            padding-left: var(--space-6);
        }

        /* Search */
        .search-container {
            position: relative;
            margin-bottom: var(--space-4);
        }

        .search-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: var(--gruvbox-bg0-soft);
            border: 1px solid var(--gruvbox-bg3);
            border-radius: var(--radius-md);
            color: var(--gruvbox-fg1);
            font-size: var(--text-sm);
            transition: all var(--duration-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gruvbox-aqua);
            box-shadow: 0 0 0 3px rgba(142, 192, 124, 0.1);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--gruvbox-bg0);
            border: 1px solid var(--gruvbox-bg3);
            border-radius: var(--radius-md);
            margin-top: var(--space-2);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            box-shadow: var(--shadow-lg);
            z-index: var(--z-dropdown);
        }

        .search-results.active {
            display: block;
        }

        /* Progress Bar - Hidden for now */
        .progress-bar {
            display: none;
        }

        /* Breadcrumbs */
        .breadcrumbs {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
            color: var(--gruvbox-fg3);
            margin-bottom: var(--space-4);
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .breadcrumb-link {
            color: var(--gruvbox-fg3);
            text-decoration: none;
            transition: color var(--duration-fast);
        }

        .breadcrumb-link:hover {
            color: var(--gruvbox-aqua);
        }

        .breadcrumb-separator {
            color: var(--gruvbox-fg4);
        }

        /* Quick Navigation */
        .quick-nav {
            position: fixed;
            bottom: var(--space-4);
            right: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .quick-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gruvbox-bg0);
            border: 1px solid var(--gruvbox-bg3);
            color: var(--gruvbox-fg2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--duration-fast);
            box-shadow: var(--shadow-md);
        }

        .quick-nav-btn:hover {
            background: var(--gruvbox-bg1);
            color: var(--gruvbox-aqua);
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .docs-layout {
                grid-template-columns: 240px 1fr;
            }
            .outline-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .docs-layout {
                grid-template-columns: 1fr;
            }
            .sidebar {
                position: fixed;
                left: -240px;
                top: 68px;
                bottom: 0;
                z-index: var(--z-modal);
                transition: left var(--duration-base);
            }
            .sidebar.open {
                left: 0;
            }
            .content-area {
                padding: var(--space-4);
            }
        }

        /* Loading Skeleton */
        .skeleton-doc {
            animation: skeleton-loading 1.5s infinite ease-in-out;
        }

        .skeleton-title {
            height: 2.5rem;
            background: var(--gruvbox-bg2);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-4);
            width: 60%;
        }

        .skeleton-paragraph {
            height: 1rem;
            background: var(--gruvbox-bg2);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-2);
        }

        .skeleton-paragraph:nth-child(odd) {
            width: 100%;
        }

        .skeleton-paragraph:nth-child(even) {
            width: 85%;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="/" class="logo">
                üß† <span>Second Brain</span> v3
            </a>
            <ul class="nav-links">
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="/insights">Insights</a></li>
                <li><a href="/api">API</a></li>
                <li><a href="#" onclick="showSettings()">‚öôÔ∏è</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="docs-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search docs..." id="searchInput">
                <div class="search-results" id="searchResults"></div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Getting Started</h3>
                <ul class="doc-tree">
                    <li class="doc-item">
                        <a href="#" class="doc-link active" onclick="loadDoc('home')">
                            <span class="doc-icon">üè†</span>
                            <span>Documentation Home</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('readme')">
                            <span class="doc-icon">üìñ</span>
                            <span>README</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('setup')">
                            <span class="doc-icon">üöÄ</span>
                            <span>Setup Guide</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('usage')">
                            <span class="doc-icon">üí°</span>
                            <span>Usage Guide</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Architecture</h3>
                <ul class="doc-tree">
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('architecture')">
                            <span class="doc-icon">üèõÔ∏è</span>
                            <span>Architecture</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('api-spec')">
                            <span class="doc-icon">üîå</span>
                            <span>API Specification</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('migration')">
                            <span class="doc-icon">üîÑ</span>
                            <span>Migration Guide</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Development</h3>
                <ul class="doc-tree">
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('dev-guide')">
                            <span class="doc-icon">üë©‚Äçüíª</span>
                            <span>Development</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('contributing')">
                            <span class="doc-icon">ü§ù</span>
                            <span>Contributing</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('testing-v3')">
                            <span class="doc-icon">üß™</span>
                            <span>Testing Guide</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Deployment</h3>
                <ul class="doc-tree">
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('deployment')">
                            <span class="doc-icon">üö¢</span>
                            <span>Deployment</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('ci-cd')">
                            <span class="doc-icon">‚öôÔ∏è</span>
                            <span>CI/CD Guide</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('env-vars')">
                            <span class="doc-icon">üîê</span>
                            <span>Environment Vars</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Releases</h3>
                <ul class="doc-tree">
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('changelog')">
                            <span class="doc-icon">üìù</span>
                            <span>Changelog</span>
                        </a>
                    </li>
                    <li class="doc-item">
                        <a href="#" class="doc-link" onclick="loadDoc('release-notes')">
                            <span class="doc-icon">üéâ</span>
                            <span>Release Notes</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content-area" id="content-area">
            <div class="content-wrapper">
                <!-- Breadcrumbs -->
                <nav class="breadcrumbs" id="breadcrumbs">
                    <div class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" onclick="loadDoc('home')">Docs</a>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                    </div>
                    <div class="breadcrumb-item">
                        <span id="current-doc">Home</span>
                    </div>
                </nav>

                <!-- Home View -->
                <div id="home-view">
                    <h1 style="font-size: var(--text-3xl); color: var(--gruvbox-fg0); margin-bottom: var(--space-3);">üìö Second Brain Documentation</h1>
                    <p style="font-size: var(--text-lg); color: var(--gruvbox-fg2); margin-bottom: var(--space-6);">Enterprise-grade AI memory system with clean architecture and comprehensive features.</p>

                    <div class="doc-grid">
                        <div class="doc-card" onclick="loadDoc('readme')">
                            <h3><span>üìñ</span> Getting Started</h3>
                            <p>Quick introduction, installation instructions, and basic usage examples to get you up and running.</p>
                        </div>

                        <div class="doc-card" onclick="loadDoc('architecture')">
                            <h3><span>üèõÔ∏è</span> Architecture</h3>
                            <p>Deep dive into Clean Architecture design, domain-driven patterns, and system components.</p>
                        </div>

                        <div class="doc-card" onclick="loadDoc('api-spec')">
                            <h3><span>üîå</span> API Reference</h3>
                            <p>Complete API specification with endpoints, request/response formats, and code examples.</p>
                        </div>

                        <div class="doc-card" onclick="loadDoc('dev-guide')">
                            <h3><span>üë©‚Äçüíª</span> Development</h3>
                            <p>Developer guide with setup instructions, coding standards, and best practices.</p>
                        </div>

                        <div class="doc-card" onclick="loadDoc('deployment')">
                            <h3><span>üö¢</span> Deployment</h3>
                            <p>Production deployment guide with Docker, Kubernetes, and cloud platform instructions.</p>
                        </div>

                        <div class="doc-card" onclick="loadDoc('testing-v3')">
                            <h3><span>üß™</span> Testing</h3>
                            <p>Comprehensive testing guide covering unit, integration, and end-to-end testing strategies.</p>
                        </div>
                    </div>
                </div>

                <!-- Document View -->
                <div id="doc-view" style="display: none;">
                    <div class="skeleton-doc" id="loading">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-paragraph"></div>
                        <div class="skeleton-paragraph"></div>
                        <div class="skeleton-paragraph"></div>
                        <div class="skeleton-paragraph"></div>
                    </div>

                    <article id="doc-content" style="display: none;">
                        <header class="doc-header">
                            <h1 class="doc-title" id="doc-title"></h1>
                            <div class="doc-meta">
                                <div class="doc-meta-item">
                                    <span>üìÅ</span>
                                    <span id="doc-path"></span>
                                </div>
                                <div class="doc-meta-item">
                                    <span>‚è±Ô∏è</span>
                                    <span id="read-time"></span>
                                </div>
                                <div class="doc-meta-item">
                                    <span>üìè</span>
                                    <span id="word-count"></span>
                                </div>
                            </div>
                        </header>
                        <div class="doc-content" id="doc-markdown"></div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Outline Panel -->
        <aside class="outline-panel" id="outline-panel">
            <h3 class="outline-title">On This Page</h3>
            <ul class="outline-list" id="outline-list">
                <!-- Dynamically populated -->
            </ul>
        </aside>
    </div>

    <!-- Quick Navigation -->
    <div class="quick-nav">
        <button class="quick-nav-btn" onclick="scrollToTop()" title="Back to top">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 3l-5 5h3v5h4V8h3L8 3z"/>
            </svg>
        </button>
        <button class="quick-nav-btn" onclick="toggleOutline()" title="Toggle outline">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect x="2" y="3" width="8" height="2"/>
                <rect x="2" y="7" width="12" height="2"/>
                <rect x="2" y="11" width="10" height="2"/>
            </svg>
        </button>
    </div>

    <script>
        // Document mapping
        const docMap = {
            'readme': '/docs/README.md',
            'setup': '/docs/docs/SETUP.md',
            'usage': '/docs/docs/USAGE.md',
            'architecture': '/docs/docs/ARCHITECTURE_V3.md',
            'api-spec': '/docs/docs/API_SPECIFICATION_v3.0.0.md',
            'migration': '/docs/docs/MIGRATION_GUIDE_V3.md',
            'dev-guide': '/docs/docs/development/DEVELOPMENT_GUIDE_v3.0.0.md',
            'contributing': '/docs/docs/development/CONTRIBUTING.md',
            'testing': '/docs/docs/development/TESTING_STRATEGY.md',
            'testing-guide': '/docs/docs/development/TESTING.md',
            'deployment': '/docs/docs/deployment/DEPLOYMENT_V3.md',
            'ci-cd': '/docs/docs/CI_CD_GUIDE_V3.md',
            'ci-caching': '/docs/docs/deployment/CI_CACHING.md',
            'env-vars': '/docs/docs/ENVIRONMENT_VARIABLES_V3.md',
            'secrets': '/docs/docs/SECRETS_MANAGEMENT.md',
            'testing-v3': '/docs/docs/testing/TESTING_GUIDE_V3.md',
            'knowledge-graph-testing': '/docs/docs/testing/knowledge_graph_testing.md',
            'reasoning-testing': '/docs/docs/testing/reasoning_engine_testing.md',
            'test-metrics': '/docs/docs/testing/test_metrics_guide.md',
            'changelog': '/docs/CHANGELOG.md',
            'release-notes': '/docs/docs/releases/RELEASE_NOTES_v3.0.0.md',
            'version-mgmt': '/docs/docs/releases/VERSION_MANAGEMENT.md'
        };

        let currentDoc = 'home';
        let scrollProgress = 0;

        // Load document
        async function loadDoc(docKey) {
            if (docKey === 'home') {
                showHome();
                return;
            }

            const docPath = docMap[docKey];
            if (!docPath) {
                console.error('Document not found:', docKey);
                return;
            }

            currentDoc = docKey;
            updateActiveLink(docKey);
            updateBreadcrumb(docKey);

            // Show loading state
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('doc-view').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('doc-content').style.display = 'none';

            try {
                const response = await fetch(docPath);
                const text = await response.text();

                // Render markdown
                const html = renderMarkdown(text);
                
                // Update content
                document.getElementById('doc-markdown').innerHTML = html;
                document.getElementById('doc-title').textContent = getTitleFromMarkdown(text) || formatDocName(docKey);
                document.getElementById('doc-path').textContent = docPath.split('/').pop();
                document.getElementById('read-time').textContent = calculateReadTime(text);
                document.getElementById('word-count').textContent = `${text.split(/\s+/).length} words`;

                // Generate outline
                generateOutline();

                // Show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('doc-content').style.display = 'block';

                // Reset scroll
                document.getElementById('content-area').scrollTop = 0;
                updateProgress();

                // Apply syntax highlighting if available
                if (typeof Prism !== 'undefined') {
                    Prism.highlightAll();
                }
            } catch (error) {
                console.error('Error loading document:', error);
                document.getElementById('loading').innerHTML = `
                    <p style="color: var(--gruvbox-red);">Failed to load document</p>
                    <p style="color: var(--gruvbox-fg3); font-size: var(--text-sm);">${error.message}</p>
                `;
            }
        }

        function showHome() {
            currentDoc = 'home';
            updateActiveLink('home');
            updateBreadcrumb('home');
            document.getElementById('home-view').style.display = 'block';
            document.getElementById('doc-view').style.display = 'none';
            document.getElementById('outline-list').innerHTML = '';
        }

        function updateActiveLink(docKey) {
            document.querySelectorAll('.doc-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.doc-link[onclick*="'${docKey}'"]`)?.classList.add('active');
        }

        function updateBreadcrumb(docKey) {
            const current = document.getElementById('current-doc');
            current.textContent = docKey === 'home' ? 'Home' : formatDocName(docKey);
        }

        function formatDocName(key) {
            return key.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        // Enhanced markdown renderer
        function renderMarkdown(markdown) {
            let html = markdown;

            // Headers with IDs for linking
            html = html.replace(/^### (.+)$/gim, '<h3 id="$1">$1</h3>');
            html = html.replace(/^## (.+)$/gim, '<h2 id="$1">$1</h2>');
            html = html.replace(/^# (.+)$/gim, '<h1 id="$1">$1</h1>');

            // Bold and italic
            html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
            html = html.replace(/_(.+?)_/g, '<em>$1</em>');

            // Links
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');

            // Code blocks with language detection
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'plaintext';
                return `<pre><code class="language-${language}">${escapeHtml(code.trim())}</code></pre>`;
            });

            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // Lists
            html = html.replace(/^\* (.+)$/gim, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            html = html.replace(/^\d+\. (.+)$/gim, '<li>$1</li>');

            // Blockquotes
            html = html.replace(/^> (.+)$/gim, '<blockquote>$1</blockquote>');

            // Tables
            html = html.replace(/\|(.+)\|/g, (match, content) => {
                const cells = content.split('|').map(cell => `<td>${cell.trim()}</td>`).join('');
                return `<tr>${cells}</tr>`;
            });

            // Paragraphs
            html = html.split('\n\n').map(para => {
                if (!para.match(/^<[h|p|u|o|b|t|l]/)) {
                    return `<p>${para}</p>`;
                }
                return para;
            }).join('\n');

            return html;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function getTitleFromMarkdown(markdown) {
            const match = markdown.match(/^# (.+)$/m);
            return match ? match[1] : null;
        }

        function calculateReadTime(text) {
            const wordsPerMinute = 200;
            const words = text.split(/\s+/).length;
            const minutes = Math.ceil(words / wordsPerMinute);
            return `${minutes} min read`;
        }

        // Generate document outline
        function generateOutline() {
            const content = document.getElementById('doc-markdown');
            const headings = content.querySelectorAll('h1, h2, h3');
            const outline = document.getElementById('outline-list');
            
            outline.innerHTML = '';
            
            headings.forEach(heading => {
                const level = heading.tagName.toLowerCase();
                const text = heading.textContent;
                const id = heading.id || text.toLowerCase().replace(/\s+/g, '-');
                
                heading.id = id;
                
                const li = document.createElement('li');
                li.className = 'outline-item';
                
                const a = document.createElement('a');
                a.href = `#${id}`;
                a.className = `outline-link ${level}`;
                a.textContent = text;
                a.onclick = (e) => {
                    e.preventDefault();
                    heading.scrollIntoView({ behavior: 'smooth' });
                };
                
                li.appendChild(a);
                outline.appendChild(li);
            });
        }

        // Progress tracking
        function updateProgress() {
            const contentArea = document.getElementById('content-area');
            const scrollHeight = contentArea.scrollHeight - contentArea.clientHeight;
            const scrolled = contentArea.scrollTop;
            const progress = scrollHeight > 0 ? (scrolled / scrollHeight) * 100 : 0;
            
            document.getElementById('progress-fill').style.width = `${progress}%`;
            scrollProgress = progress;
        }

        // Search functionality
        let searchTimeout;
        function handleSearch(event) {
            clearTimeout(searchTimeout);
            const query = event.target.value.toLowerCase();
            
            if (query.length < 2) {
                document.getElementById('searchResults').classList.remove('active');
                return;
            }
            
            searchTimeout = setTimeout(() => {
                searchDocuments(query);
            }, 300);
        }

        function searchDocuments(query) {
            const results = [];
            
            // Search through document titles
            Object.entries(docMap).forEach(([key, path]) => {
                const title = formatDocName(key).toLowerCase();
                if (title.includes(query)) {
                    results.push({ key, title: formatDocName(key), path });
                }
            });
            
            displaySearchResults(results);
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<p style="padding: var(--space-3); color: var(--gruvbox-fg3);">No results found</p>';
            } else {
                container.innerHTML = results.map(result => `
                    <div class="search-result" onclick="loadDoc('${result.key}'); closeSearch();">
                        <strong>${result.title}</strong>
                        <small>${result.path}</small>
                    </div>
                `).join('');
            }
            
            container.classList.add('active');
        }

        function closeSearch() {
            document.getElementById('searchResults').classList.remove('active');
            document.getElementById('searchInput').value = '';
        }

        // UI functions
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function toggleOutline() {
            const layout = document.querySelector('.docs-layout');
            const outline = document.getElementById('outline-panel');
            
            if (window.innerWidth > 1200) {
                if (outline.style.display === 'none') {
                    outline.style.display = 'block';
                    layout.style.gridTemplateColumns = '240px 1fr 200px';
                } else {
                    outline.style.display = 'none';
                    layout.style.gridTemplateColumns = '240px 1fr';
                }
            }
        }

        function scrollToTop() {
            document.getElementById('content-area').scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Search
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Progress tracking
            document.getElementById('content-area').addEventListener('scroll', updateProgress);
            
            // Click outside to close search
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-container')) {
                    closeSearch();
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K for search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                
                // Escape to close search
                if (e.key === 'Escape') {
                    closeSearch();
                }
            });
            
            // Load home by default
            showHome();
        });

        // Add search result styles
        const style = document.createElement('style');
        style.textContent = `
            .search-result {
                padding: var(--space-3);
                cursor: pointer;
                transition: background var(--duration-fast);
            }
            .search-result:hover {
                background: var(--gruvbox-bg1);
            }
            .search-result strong {
                display: block;
                color: var(--gruvbox-fg0);
                margin-bottom: var(--space-1);
            }
            .search-result small {
                color: var(--gruvbox-fg3);
                font-size: var(--text-xs);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>