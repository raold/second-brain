# Second Brain API Documentation - v2.8.2

## Synthesis API Endpoints

### Report Generation

#### Generate Report
Generate a comprehensive report with customizable options.

**Endpoint**: `POST /api/v1/synthesis/reports/generate`

**Request Body**:
```json
{
  "config": {
    "report_type": "weekly",  // daily, weekly, monthly, quarterly, annual, insights, progress, knowledge_map, learning_path, custom
    "format": "pdf",          // pdf, html, markdown, json, email, docx, csv
    "start_date": "2024-01-01T00:00:00Z",
    "end_date": "2024-01-31T23:59:59Z",
    "relative_timeframe": "last_7_days",  // Alternative to start/end dates
    "include_memories": true,
    "include_insights": true,
    "include_graphs": true,
    "include_recommendations": true,
    "use_gpt4_summary": true,
    "summary_length": 500,
    "analysis_depth": "deep",  // shallow, medium, deep
    "email_recipients": ["user@example.com"],
    "webhook_url": "https://example.com/webhook"
  },
  "immediate": true,
  "priority": "high",
  "callback_url": "https://example.com/callback"
}
```

**Response**:
```json
{
  "id": "report_123",
  "config": { /* Report configuration */ },
  "title": "Weekly Report - January 2024",
  "summary": "Executive summary generated by AI...",
  "sections": [
    {
      "title": "Overview",
      "content": "Detailed overview...",
      "order": 1,
      "include_visualization": true,
      "visualization_type": "bar_chart"
    }
  ],
  "metrics": {
    "total_memories": 150,
    "new_memories": 25,
    "memories_reviewed": 50,
    "active_days": 7,
    "peak_activity_time": "09:00",
    "average_daily_memories": 3.5,
    "topics_covered": ["AI", "Python", "Machine Learning"],
    "knowledge_growth_rate": 15.5,
    "retention_rate": 0.85,
    "top_insights": [
      {"title": "Insight 1", "confidence": 0.9}
    ],
    "recommendations": ["Review older memories", "Add more procedural memories"]
  },
  "generation_time_ms": 1500,
  "format": "pdf",
  "file_url": "https://storage.example.com/reports/report_123.pdf",
  "file_size_bytes": 150000,
  "delivered": true,
  "delivery_status": "Email sent",
  "generated_at": "2024-01-31T10:00:00Z"
}
```

#### List Reports
Retrieve a list of generated reports with filtering options.

**Endpoint**: `GET /api/v1/synthesis/reports`

**Query Parameters**:
- `report_type` (optional): Filter by report type
- `format` (optional): Filter by format
- `start_date` (optional): Filter by generation date
- `end_date` (optional): Filter by generation date
- `delivered` (optional): Filter by delivery status
- `limit` (default: 20, max: 100): Number of results
- `offset` (default: 0): Pagination offset

#### Get Report
Retrieve a specific report by ID.

**Endpoint**: `GET /api/v1/synthesis/reports/{report_id}`

#### Download Report
Download a report in the specified format.

**Endpoint**: `GET /api/v1/synthesis/reports/{report_id}/download`

**Query Parameters**:
- `format` (optional): Override original format

#### Schedule Report
Create a scheduled report generation.

**Endpoint**: `POST /api/v1/synthesis/reports/schedule`

**Request Body**:
```json
{
  "name": "Weekly Summary",
  "config": { /* Report configuration */ },
  "enabled": true,
  "cron_expression": "0 9 * * MON",  // Every Monday at 9 AM
  "timezone": "UTC",
  "auto_deliver": true,
  "delivery_format": "pdf"
}
```

#### List Schedules
Get all report schedules.

**Endpoint**: `GET /api/v1/synthesis/reports/schedules`

#### Delete Schedule
Remove a report schedule.

**Endpoint**: `DELETE /api/v1/synthesis/reports/schedules/{schedule_id}`

#### Create Template
Create a reusable report template.

**Endpoint**: `POST /api/v1/synthesis/reports/templates`

**Request Body**:
```json
{
  "name": "Monthly Analysis",
  "description": "Comprehensive monthly analysis",
  "report_type": "monthly",
  "sections": ["summary", "memories", "insights", "recommendations"],
  "default_format": "pdf",
  "custom_css": ".header { color: blue; }",
  "include_summary": true
}
```

#### List Templates
Get available report templates.

**Endpoint**: `GET /api/v1/synthesis/reports/templates`

### Spaced Repetition

#### Schedule Review
Schedule a memory for spaced repetition review.

**Endpoint**: `POST /api/v1/synthesis/repetition/schedule`

**Query Parameters**:
- `memory_id` (required): Memory to schedule
- `algorithm` (default: "sm2"): sm2, anki, leitner, custom

**Request Body** (optional):
```json
{
  "initial_ease_factor": 2.5,
  "minimum_ease_factor": 1.3,
  "easy_bonus": 1.3,
  "hard_factor": 0.8,
  "again_factor": 0.5,
  "learning_steps": [1, 10],
  "graduating_interval": 1,
  "easy_interval": 4,
  "maximum_interval": 365,
  "leech_threshold": 8,
  "leech_action": "suspend"
}
```

**Response**:
```json
{
  "memory_id": "mem_123",
  "scheduled_date": "2024-02-01T10:00:00Z",
  "algorithm": "sm2",
  "current_strength": {
    "ease_factor": 2.5,
    "interval": 1,
    "repetitions": 0,
    "retention_rate": 0.9,
    "stability": 1.0,
    "last_review": null
  },
  "overdue_days": 0,
  "priority_score": 0.8,
  "created_at": "2024-01-31T10:00:00Z"
}
```

#### Bulk Schedule Reviews
Schedule multiple memories for review.

**Endpoint**: `POST /api/v1/synthesis/repetition/bulk-schedule`

**Request Body**:
```json
{
  "memory_ids": ["mem_1", "mem_2", "mem_3"],
  "algorithm": "anki",
  "config": { /* Optional algorithm config */ },
  "force_schedule": false
}
```

#### Get Due Reviews
Retrieve memories due for review.

**Endpoint**: `GET /api/v1/synthesis/repetition/due`

**Query Parameters**:
- `limit` (default: 100, max: 1000): Maximum results
- `include_overdue` (default: true): Include overdue reviews

#### Start Review Session
Begin a new review session.

**Endpoint**: `POST /api/v1/synthesis/repetition/sessions/start`

**Response**:
```json
{
  "id": "session_123",
  "user_id": "user_456",
  "algorithm": "sm2",
  "total_reviews": 20,
  "completed_reviews": 0,
  "correct_reviews": 0,
  "average_time_seconds": 0,
  "started_at": "2024-01-31T10:00:00Z",
  "statistics": {
    "again_count": 0,
    "hard_count": 0,
    "good_count": 0,
    "easy_count": 0
  }
}
```

#### End Review Session
Complete a review session and get statistics.

**Endpoint**: `POST /api/v1/synthesis/repetition/sessions/{session_id}/end`

#### Record Review
Record the result of a memory review.

**Endpoint**: `POST /api/v1/synthesis/repetition/review/{memory_id}`

**Query Parameters**:
- `session_id` (required): Current session ID
- `difficulty` (required): again, hard, good, easy
- `time_taken_seconds` (required): Time spent on review
- `confidence_level` (optional): 0.0-1.0
- `notes` (optional): Review notes

**Response**:
```json
{
  "success": true,
  "next_review": "2024-02-03T10:00:00Z",
  "new_interval": 3,
  "ease_factor": 2.5
}
```

#### Get Learning Statistics
Retrieve comprehensive learning statistics.

**Endpoint**: `GET /api/v1/synthesis/repetition/statistics`

**Query Parameters**:
- `period` (default: "all_time"): all_time, today, week, month

**Response**:
```json
{
  "total_memories": 500,
  "scheduled_memories": 450,
  "overdue_memories": 25,
  "average_retention_rate": 0.87,
  "daily_review_goal": 20,
  "streak_days": 15,
  "best_streak_days": 30,
  "total_reviews": 2000,
  "perfect_reviews": 1700,
  "learning_velocity": 3.5,
  "forgetting_curves": [
    {
      "days": [1, 2, 3, 4, 5, 6, 7],
      "retention_rates": [0.9, 0.82, 0.75, 0.68, 0.62, 0.56, 0.51],
      "algorithm": "sm2",
      "sample_size": 100
    }
  ],
  "difficulty_distribution": {
    "again": 0.1,
    "hard": 0.2,
    "good": 0.5,
    "easy": 0.2
  },
  "time_distribution": {
    "morning": 0.3,
    "afternoon": 0.4,
    "evening": 0.3
  }
}
```

### WebSocket Real-time Updates

#### WebSocket Connection
Establish WebSocket connection for real-time updates.

**Endpoint**: `WS /api/v1/synthesis/ws?api_key={api_key}`

**Connection Protocol**:
1. Connect with API key as query parameter
2. Send subscription requests
3. Receive real-time events
4. Handle ping/pong for keepalive

**Message Types**:

**Subscribe**:
```json
{
  "type": "subscribe",
  "event_types": ["memory.created", "memory.updated"],
  "event_patterns": ["report.*"],
  "filters": {
    "priority": "high",
    "user_id": "user_123"
  }
}
```

**Event**:
```json
{
  "id": "evt_123",
  "type": "memory.created",
  "timestamp": "2024-01-31T10:00:00Z",
  "priority": "normal",
  "data": {
    "memory_id": "mem_789",
    "user_id": "user_123",
    "content": "New memory content"
  }
}
```

#### Subscribe to Events (HTTP)
Subscribe to events via HTTP (for non-WebSocket clients).

**Endpoint**: `POST /api/v1/synthesis/websocket/subscribe`

**Query Parameters**:
- `connection_id` (required): Connection identifier

**Request Body**:
```json
{
  "event_types": ["report.completed", "review.due"],
  "event_patterns": ["system.*"],
  "filters": {
    "priority": "high"
  }
}
```

#### Unsubscribe from Events
Remove event subscription.

**Endpoint**: `DELETE /api/v1/synthesis/websocket/subscribe/{subscription_id}`

**Query Parameters**:
- `connection_id` (required): Connection identifier

#### Get WebSocket Metrics
Retrieve WebSocket service metrics.

**Endpoint**: `GET /api/v1/synthesis/websocket/metrics`

**Response**:
```json
{
  "active_connections": 10,
  "total_connections": 50,
  "events_sent_total": 1000,
  "events_received_total": 800,
  "errors_total": 5,
  "average_latency_ms": 12.3,
  "subscriptions_total": 25,
  "connection_duration_avg_seconds": 300.5,
  "events_by_type": {
    "memory.created": 200,
    "review.completed": 150,
    "report.completed": 50
  },
  "connections_by_user": {
    "user_1": 3,
    "user_2": 2
  }
}
```

### System Status

#### Get Synthesis Status
Check the status of all synthesis services.

**Endpoint**: `GET /api/v1/synthesis/synthesis/status`

**Response**:
```json
{
  "report_generator": {
    "status": "operational",
    "version": "2.8.2"
  },
  "repetition_scheduler": {
    "status": "operational",
    "algorithms": ["sm2", "anki", "leitner"]
  },
  "websocket_service": {
    "status": "operational",
    "connections": 10,
    "metrics": { /* WebSocket metrics */ }
  }
}
```

## Authentication

All API endpoints require authentication via API key:

**Header**: `X-API-Key: your-api-key`

## Rate Limiting

- Report generation: 10 requests per minute
- Spaced repetition: 100 requests per minute
- WebSocket events: 10 events per second per connection
- General API: 1000 requests per hour

## Error Responses

All endpoints follow a consistent error format:

```json
{
  "error": {
    "code": 400,
    "message": "Invalid request",
    "type": "ValidationError",
    "timestamp": "2024-01-31T10:00:00Z",
    "path": "/api/v1/synthesis/reports/generate",
    "method": "POST",
    "details": [
      {
        "field": "config.report_type",
        "message": "Invalid report type"
      }
    ]
  }
}
```

## Common HTTP Status Codes

- `200 OK`: Successful request
- `201 Created`: Resource created successfully
- `400 Bad Request`: Invalid request parameters
- `401 Unauthorized`: Missing or invalid API key
- `403 Forbidden`: Insufficient permissions
- `404 Not Found`: Resource not found
- `422 Unprocessable Entity`: Validation error
- `429 Too Many Requests`: Rate limit exceeded
- `500 Internal Server Error`: Server error

## Pagination

List endpoints support pagination with:
- `limit`: Number of results (max 100)
- `offset`: Skip N results

Response includes total count:
```json
{
  "items": [...],
  "total": 150,
  "limit": 20,
  "offset": 0
}
```